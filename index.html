<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text-to-Speech Emoji Interface</title>
    <style>
        /* Minimal Dutch Style Design */
        :root {
            --color-bg-primary: #FFFFFF;
            --color-text-primary: #000000;
            --color-text-secondary: #666666;
            --color-active: #000000;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --font-size-base: 16px;
            --font-size-large: 18px;
            --touch-target-min: 48px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
        }

        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow-x: hidden;
            overflow-y: auto;
            background: var(--color-bg-primary);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            font-size: var(--font-size-base);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            color: var(--color-text-primary);
            line-height: 1.4;
            display: flex;
            flex-direction: column;
        }

        .top-bar {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--color-bg-primary);
            width: 100%;
            box-sizing: border-box;
            flex-shrink: 0;
            flex-wrap: wrap;
        }

        .search-container {
            display: flex;
            align-items: center;
            flex: 1;
            min-width: 200px;
        }

        .search-box {
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md);
            font-size: var(--font-size-base);
            font-weight: 400;
            background: transparent;
            border: none;
            border-bottom: 1px solid var(--color-text-secondary);
            color: var(--color-text-primary);
            outline: none;
            transition: border-color 150ms ease;
        }

        .search-box:focus {
            border-bottom-color: var(--color-text-primary);
        }

        .search-box::placeholder {
            color: var(--color-text-secondary);
        }

        .category-tabs {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--spacing-md);
            flex-wrap: wrap;
        }

        .category-tab {
            padding: var(--spacing-sm);
            font-size: var(--font-size-large);
            font-weight: 400;
            background: transparent;
            border: none;
            cursor: pointer;
            color: var(--color-text-secondary);
            min-height: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 2px;
        }

        .category-tab:hover {
            color: var(--color-text-primary);
        }

        .category-tab.active {
            color: var(--color-text-primary);
            font-weight: 500;
            background: #F0F0F0;
        }

        .category-english {
            font-size: 11px;
            font-weight: 400;
            color: var(--color-text-secondary);
        }

        .category-tab:hover .category-english,
        .category-tab.active .category-english {
            color: var(--color-text-secondary);
        }

        .info-button {
            position: fixed;
            bottom: var(--spacing-md);
            right: var(--spacing-md);
            width: 32px;
            height: 32px;
            padding: 0;
            font-size: 16px;
            background: transparent;
            border: none;
            cursor: pointer;
            color: var(--color-text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        .info-button:hover {
            color: var(--color-text-primary);
        }

        @media (max-width: 767px) {
            .top-bar {
                gap: var(--spacing-sm);
            }

            .search-container {
                min-width: 0;
                flex: 1;
            }

            .search-box {
                font-size: 15px;
                padding: var(--spacing-sm);
            }

            .category-tabs {
                gap: var(--spacing-sm);
                flex-shrink: 0;
            }
            
            .category-tab {
                font-size: var(--font-size-base);
                padding: 4px var(--spacing-sm);
                min-height: auto;
            }

            .category-english {
                font-size: 10px;
            }

            .info-button {
                width: 28px;
                height: 28px;
                font-size: 14px;
                bottom: var(--spacing-sm);
                right: var(--spacing-sm);
            }
        }

        .audio-grid {
            display: grid;
            grid-template-columns: repeat(5, minmax(0, 1fr));
            width: 100%;
            flex: 1;
            min-height: 0;
            background: var(--color-bg-primary);
            padding: 4px;
            gap: 4px;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            box-sizing: border-box;
        }

        @media (min-width: 768px) {
            .audio-grid {
                grid-template-columns: repeat(5, minmax(0, 1fr));
            }
        }

        @media (min-width: 1024px) {
            .audio-grid {
                grid-template-columns: repeat(6, minmax(0, 1fr));
            }
        }

        @media (min-width: 1440px) {
            .audio-grid {
                grid-template-columns: repeat(8, minmax(0, 1fr));
            }
        }

        .audio-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            min-width: 0;
            padding: 8px;
            cursor: pointer;
            transition: background 150ms ease;
            box-sizing: border-box;
            min-height: 120px;
        }

        .audio-item:hover {
            background: #FAFAFA;
        }

        .audio-item.playing {
            background: #F5F5F5;
        }

        .emoji {
            font-size: 40px;
            line-height: 1;
            display: inline-block;
            margin-bottom: var(--spacing-sm);
        }

        @media (max-width: 767px) {
            .emoji {
                font-size: 32px;
            }
        }

        .audio-item.playing .emoji {
            animation: subtlePulse 1.5s ease-in-out infinite;
        }

        @keyframes subtlePulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.12);
            }
        }

        .filename {
            font-size: 14px;
            color: var(--color-text-primary);
            font-weight: 400;
            text-align: center;
            pointer-events: none;
            margin-bottom: 4px;
        }

        @media (max-width: 767px) {
            .filename {
                font-size: 13px;
            }
        }

        .audio-item.playing .filename {
            font-weight: 500;
        }

        .english-translation {
            font-size: 13px;
            color: var(--color-text-secondary);
            font-weight: 400;
            text-align: center;
            pointer-events: none;
        }

        @media (max-width: 767px) {
            .english-translation {
                font-size: 12px;
            }
        }

        .phonetic-pronunciation {
            font-size: 11px;
            color: #87CEEB;
            font-weight: 400;
            text-align: center;
            pointer-events: none;
            font-style: italic;
            margin-top: 2px;
            opacity: 0;
            transition: opacity 150ms ease;
        }

        .audio-item.show-phonetic .phonetic-pronunciation {
            opacity: 1;
        }

        @media (max-width: 767px) {
            .phonetic-pronunciation {
                font-size: 10px;
            }
        }

        /* Refined animations - subtle and purposeful */
        .emoji-face.animate {
            animation: gentleBounce 2.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes gentleBounce {
            0%, 100% {
                transform: translateY(0) scale(1);
            }
            50% {
                transform: translateY(-4px) scale(1.02);
            }
        }

        .emoji-face-updown.animate {
            animation: faceUpDown 2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes faceUpDown {
            0%, 100% {
                transform: translateY(0);
            }
            25% {
                transform: translateY(-6px);
            }
            75% {
                transform: translateY(6px);
            }
        }

        .emoji-face-leftright.animate {
            animation: faceLeftRight 2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes faceLeftRight {
            0%, 100% {
                transform: translateX(0);
            }
            25% {
                transform: translateX(-6px);
            }
            75% {
                transform: translateX(6px);
            }
        }

        .emoji-hand.animate {
            animation: subtleWave 2.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes subtleWave {
            0%, 100% {
                transform: rotate(0deg) scale(1);
            }
            25% {
                transform: rotate(-2deg) scale(1.01);
            }
            75% {
                transform: rotate(2deg) scale(1.01);
            }
        }

        .emoji-object.animate {
            animation: gentleFloat 3.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes gentleFloat {
            0%, 100% {
                transform: translateY(0) scale(1);
            }
            50% {
                transform: translateY(-6px) scale(1.015);
            }
        }

        .emoji-arrow-up.animate {
            animation: arrowUp 1.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes arrowUp {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-5px);
            }
        }

        .emoji-arrow-down.animate {
            animation: arrowDown 1.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes arrowDown {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(5px);
            }
        }

        .emoji-arrow-left.animate {
            animation: arrowLeft 1.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes arrowLeft {
            0%, 100% {
                transform: translateX(0);
            }
            50% {
                transform: translateX(-5px);
            }
        }

        .emoji-arrow-right.animate {
            animation: arrowRight 1.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes arrowRight {
            0%, 100% {
                transform: translateX(0);
            }
            50% {
                transform: translateX(5px);
            }
        }

        .emoji-food.animate {
            animation: foodBounce 3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes foodBounce {
            0%, 100% {
                transform: translateY(0) rotate(0deg) scale(1);
            }
            25% {
                transform: translateY(-3px) rotate(-1.5deg) scale(1.01);
            }
            75% {
                transform: translateY(-3px) rotate(1.5deg) scale(1.01);
            }
        }

        .emoji-music.animate {
            animation: musicRotate 3.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes musicRotate {
            0%, 100% {
                transform: rotate(0deg) translateY(0) scale(1);
            }
            25% {
                transform: rotate(-4deg) translateY(-2px) scale(1.01);
            }
            75% {
                transform: rotate(4deg) translateY(-2px) scale(1.01);
            }
        }

        .emoji-nature.animate {
            animation: natureSway 4.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes natureSway {
            0%, 100% {
                transform: rotate(0deg) translateY(0) scale(1);
            }
            25% {
                transform: rotate(-1.5deg) translateY(-3px) scale(1.01);
            }
            75% {
                transform: rotate(1.5deg) translateY(-3px) scale(1.01);
            }
        }

        /* Focus states for accessibility */
        .category-tab:focus-visible {
            outline: 2px solid var(--color-active);
            outline-offset: 2px;
        }

        .audio-item:focus-visible {
            outline: 2px solid var(--color-active);
            outline-offset: 2px;
        }

        /* Touch-friendly - prevent text selection on mobile */
        .audio-item,
        .category-tab {
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
            -webkit-touch-callout: none;
            user-select: none;
            -webkit-user-select: none;
        }


        /* Reduced motion preference */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Modal styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: var(--color-bg-primary);
            border-radius: 0;
            padding: var(--spacing-lg);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid #000000;
            position: relative;
            animation: modalFadeIn 200ms ease;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(-10px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal-close {
            position: absolute;
            top: var(--spacing-md);
            right: var(--spacing-md);
            background: transparent;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--color-text-primary);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            color: var(--color-text-secondary);
        }

        .modal-title {
            font-size: var(--font-size-large);
            font-weight: 500;
            color: var(--color-text-primary);
            margin-bottom: var(--spacing-md);
            text-align: left;
        }

        .modal-body {
            font-size: var(--font-size-base);
            color: var(--color-text-primary);
            line-height: 1.6;
            text-align: left;
        }

        .modal-body a {
            color: var(--color-text-primary);
            text-decoration: underline;
            font-weight: 400;
        }

        .modal-body a:hover {
            color: var(--color-text-secondary);
        }

        .modal-body br {
            margin: var(--spacing-sm) 0;
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            .audio-item {
                border: 1px solid #000000;
            }
        }
    </style>
</head>
<body>
    <div class="modal-overlay" id="infoModal">
        <div class="modal-content">
            <button class="modal-close" id="modalClose" aria-label="Close">Ã—</button>
            <div class="modal-title">About CantoTap</div>
            <div class="modal-body">
                CantoTap is designed for users who want to speak Cantonese but can't, like my grandma. Simply tap on the emoji buttons to hear common Cantonese phrases spoken aloud.<br><br>
                Developed by<br>
                <a href="https://youtube.com/beatsaway" target="_blank">BeatsAway</a><br><br>
                <a href="https://buymeacoffee.com/beatsaway" target="_blank">Support this developer</a>
            </div>
        </div>
    </div>
    <div class="audio-grid" id="audioGrid"></div>

    <script>
        // Define groups with emoji, text to speak, and category
        const groups = [
            // å¸¸ç”¨ (Common/Frequently used)
            { files: [21], name: 'ä¿‚', emoji: 'ğŸ™‚â€â†•ï¸', category: 'å¸¸ç”¨', english: 'Yes' },
            { files: [22], name: 'å””ä¿‚', emoji: 'ğŸ™‚â€â†”ï¸', category: 'å¸¸ç”¨', english: 'No' },
            { files: [23, 24], name: 'å¥½', emoji: 'ğŸ‘', category: 'å¸¸ç”¨', english: 'Good' },
            { files: [], name: 'å””å¥½', emoji: 'ğŸ‘', category: 'å¸¸ç”¨', english: 'Not good' },
            { files: [44, 45, 46, 47], name: 'å¥½æ­£', emoji: 'ğŸ’¯', category: 'å¸¸ç”¨', english: 'Very good' },
            { files: [25], name: 'éº»éº»', emoji: 'ğŸ¤·', category: 'å¸¸ç”¨', english: 'So-so' },
            { files: [29], name: 'å””å¤ ', emoji: 'ğŸ¤”', category: 'å¸¸ç”¨', english: 'Not enough' },
            { files: [30], name: 'å¤ å•¦', emoji: 'ğŸ‘Œ', category: 'å¸¸ç”¨', english: 'Enough' },
            { files: [38, 39, 40], name: 'å””èˆ’æœ', emoji: 'ğŸ˜Ÿ', category: 'å¸¸ç”¨', english: 'Uncomfortable' },
            { files: [], name: 'å¹¾èˆ’æœ', emoji: 'ğŸ˜Š', category: 'å¸¸ç”¨', english: 'Comfortable' },
            { files: [], name: 'å””å¥½æ„æ€', emoji: 'ğŸ™‡', category: 'å¸¸ç”¨', english: 'Excuse me' },
            { files: [], name: 'å¹¾å¤šéŒ¢', emoji: 'ğŸ’°', category: 'å¸¸ç”¨', english: 'How much' },
            { files: [], name: 'é‚Šåº¦', emoji: 'ğŸ“', category: 'å¸¸ç”¨', english: 'Where' },
            { files: [], name: 'è¦å‘¢å€‹', emoji: 'ğŸ‘‰', category: 'å¸¸ç”¨', english: 'want this' },
            { files: [], name: 'è¦å—°å€‹', emoji: 'ğŸ‘ˆ', category: 'å¸¸ç”¨', english: 'want that' },
            { files: [], name: 'åŸ‹å–®å””è©²', emoji: 'ğŸ’³', category: 'å¸¸ç”¨', english: 'Check please' },
            { files: [], name: 'å””è©²', emoji: 'ğŸ™', category: 'å¸¸ç”¨', english: 'Please' },
            { files: [], name: 'ç—›', emoji: 'ğŸ˜£', category: 'å¸¸ç”¨', english: 'Pain' },
            { files: [], name: 'æ”°', emoji: 'ğŸ˜´', category: 'å¸¸ç”¨', english: 'Tired' },
            { files: [], name: 'æ˜ç™½', emoji: 'âœ…', category: 'å¸¸ç”¨', english: 'I understand' },

            // ä¹œD (What D)
            { files: [1, 2, 3], name: 'ç†±D', emoji: 'ğŸ”†', category: 'ä¹œD', english: 'Warmer' },
            { files: [4, 5, 6], name: 'å‡D', emoji: 'â„ï¸', category: 'ä¹œD', english: 'Colder' },
            { files: [12, 13, 14], name: 'è¿‘D', emoji: 'ğŸ ', category: 'ä¹œD', english: 'Closer' },
            { files: [15, 16, 17], name: 'é D', emoji: 'ğŸ¡', category: 'ä¹œD', english: 'Further' },
            { files: [], name: 'å¤šD', emoji: 'â•', category: 'ä¹œD', english: 'More' },
            { files: [], name: 'å°‘D', emoji: 'â–', category: 'ä¹œD', english: 'Less' },
            { files: [43, 7, 8], name: 'é«˜D', emoji: 'â¬†ï¸', category: 'ä¹œD', english: 'Higher' },
            { files: [41], name: 'å·¦D', emoji: 'â¬…ï¸', category: 'ä¹œD', english: 'More left' },
            { files: [48], name: 'å³D', emoji: 'â¡ï¸', category: 'ä¹œD', english: 'More right' },
            { files: [9, 10, 11], name: 'ä½D', emoji: 'â¬‡ï¸', category: 'ä¹œD', english: 'Lower' },
            { files: [], name: 'å¤§è²D', emoji: 'ğŸ”Š', category: 'ä¹œD', english: 'Louder' },
            { files: [], name: 'ç´°è²D', emoji: 'ğŸ”‡', category: 'ä¹œD', english: 'Quieter' },
            { files: [], name: 'å¤§åŠ›D', emoji: 'ğŸ’ª', category: 'ä¹œD', english: 'Harder' },
            { files: [], name: 'ç´°åŠ›D', emoji: 'ğŸ¤', category: 'ä¹œD', english: 'Softer' },
            { files: [], name: 'å…‰D', emoji: 'ğŸŒ–', category: 'ä¹œD', english: 'Brighter' },
            { files: [], name: 'æš—D', emoji: 'ğŸŒ’', category: 'ä¹œD', english: 'Darker' },
            { files: [], name: 'å¿«D', emoji: 'âš¡', category: 'ä¹œD', english: 'Faster' },
            { files: [], name: 'æ…¢D', emoji: 'ğŸŒ', category: 'ä¹œD', english: 'Slower' },
            { files: [], name: 'é•·D', emoji: 'ğŸ“', category: 'ä¹œD', english: 'Longer' },
            { files: [], name: 'çŸ­D', emoji: 'âœ‚ï¸', category: 'ä¹œD', english: 'Shorter' },

            // æƒ³ä¹œä¹œ (Want what)
            { files: [33], name: 'æƒ³è½éŸ³æ¨‚', emoji: 'ğŸµ', category: 'æƒ³ä¹œä¹œ', english: 'Want to listen to music' },
            { files: [34], name: 'æƒ³ç‡å‹•ç‰©', emoji: 'ğŸ¾', category: 'æƒ³ä¹œä¹œ', english: 'Want to see animals' },
            { files: [35], name: 'æƒ³ç‡èŠ±è‰', emoji: 'ğŸŒ³', category: 'æƒ³ä¹œä¹œ', english: 'Want to see plants' },
            { files: [36], name: 'æƒ³ç‡ç›¸', emoji: 'ğŸ“·', category: 'æƒ³ä¹œä¹œ', english: 'Want to see photos' },
            { files: [37], name: 'æƒ³ç‡é›»è¦–', emoji: 'ğŸ“º', category: 'æƒ³ä¹œä¹œ', english: 'Want to watch TV' },
            { files: [], name: 'æƒ³èµ·èº«', emoji: 'ğŸ§', category: 'æƒ³ä¹œä¹œ', english: 'Want to stand up' },
            { files: [], name: 'æƒ³è¨“ä½', emoji: 'ğŸ›Œ', category: 'æƒ³ä¹œä¹œ', english: 'Want to lie down' },
            { files: [], name: 'æƒ³å', emoji: 'ğŸª‘', category: 'æƒ³ä¹œä¹œ', english: 'Want to sit' },
            { files: [], name: 'æƒ³å»æ‰€', emoji: 'ğŸš½', category: 'æƒ³ä¹œä¹œ', english: 'Want to use toilet' },
            { files: [], name: 'æƒ³è½‰èº«', emoji: 'ğŸ”„', category: 'æƒ³ä¹œä¹œ', english: 'Want to turn over' },
            { files: [], name: 'æƒ³æ›è¡«', emoji: 'ğŸ‘•', category: 'æƒ³ä¹œä¹œ', english: 'Want to change clothes' },
            { files: [], name: 'æƒ³é£²æ°´', emoji: 'ğŸ¥¤', category: 'æƒ³ä¹œä¹œ', english: 'Want to drink' },
            { files: [], name: 'æƒ³é£Ÿå˜¢', emoji: 'ğŸ½ï¸', category: 'æƒ³ä¹œä¹œ', english: 'Want to eat' },
            { files: [], name: 'æƒ³æŠ¹èº«', emoji: 'ğŸ§½', category: 'æƒ³ä¹œä¹œ', english: 'Want to wipe body' },
            { files: [], name: 'æƒ³æ›ç‰‡', emoji: 'ğŸ©¹', category: 'æƒ³ä¹œä¹œ', english: 'Want to change pad' },
            { files: [], name: 'æƒ³æŒ‰æ‘©', emoji: 'ğŸ’†', category: 'æƒ³ä¹œä¹œ', english: 'Want massage' },
            { files: [], name: 'æƒ³é–‹é›»è¦–', emoji: 'ğŸ“º', category: 'æƒ³ä¹œä¹œ', english: 'Want to turn on TV' },
            { files: [], name: 'æƒ³ç‡æ™‚é–“', emoji: 'ğŸ•', category: 'æƒ³ä¹œä¹œ', english: 'Want to see time' },
            { files: [], name: 'æƒ³å‡ºè¡—', emoji: 'ğŸš¶', category: 'æƒ³ä¹œä¹œ', english: 'Want to go out' },
            { files: [], name: 'æƒ³ç“è¦º', emoji: 'ğŸ˜´', category: 'æƒ³ä¹œä¹œ', english: 'Want to sleep' }
        ];

        const groupItems = {};
        let currentlyPlayingElement = null;
        let currentUtterance = null;
        const groupPlayedSounds = {}; // Track which sounds have been played in each group
        let currentCategory = 'å¸¸ç”¨'; // Default category
        let searchTerm = ''; // Search term for filtering

        // Cantonese Word â†’ English Words (legitimate words that sound similar)
        const cantoneseToEnglishPhonetic = {
            'ä¿‚': 'height',
            'å””ä¿‚': 'ohm height',
            'å¥½': 'whole',
            'å””å¥½': 'ohm whole',
            'å¥½æ­£': 'whole jeng',
            'éº»éº»': 'ma ma',
            'å””å¤ ': 'ohm go',
            'å¤ å•¦': 'go laugh',
            'ç†±D': 'yeet dee',
            'å‡D': 'don\'t dee',
            'è¿‘D': 'carn dee',
            'é D': 'yearn dee',
            'é«˜D': 'go dee',
            'å·¦D': 'jaw dee',
            'å³D': 'yo dee',
            'ä½D': 'die dee',
            'å¤šD': 'door dee',
            'å°‘D': 'silk dee',
            'å¤§è²D': 'die sing dee',
            'ç´°è²D': 'side sing dee',
            'å¤§åŠ›D': 'die leg dee',
            'ç´°åŠ›D': 'side leg dee',
            'å…‰D': 'gone dee',
            'æš—D': 'arm dee',
            'å””èˆ’æœ': 'ohm she folk',
            'å¹¾èˆ’æœ': 'gay she folk',
            'æƒ³è½éŸ³æ¨‚': 'song ting yum orc',
            'æƒ³ç‡å‹•ç‰©': 'song tie don\'t mud',
            'æƒ³ç‡èŠ±è‰': 'song tie far chao',
            'æƒ³ç‡ç›¸': 'song tie song',
            'æƒ³ç‡é›»è¦–': 'song tie dean see',
            'æƒ³èµ·èº«': 'song hay son',
            'æƒ³è¨“ä½': 'song fun die',
            'æƒ³å': 'song chore',
            'æƒ³å»æ‰€': 'song cheese saw',
            'å””å¥½æ„æ€': 'ohm ho yee see',
            'å¹¾å¤šéŒ¢': 'gay door chin',
            'é‚Šåº¦': 'been dough',
            'è¦å‘¢å€‹': 'you nay gore',
            'è¦å—°å€‹': 'you gore gore',
            'åŸ‹å–®å””è©²': 'my dan ohm guy',
            'å””è©²': 'ohm guy',
            'ç—›': 'tong',
            'æ”°': 'gway',
            'æ˜ç™½': 'ming back',
            'å¿«D': 'fire dee',
            'æ…¢D': 'man dee',
            'é•·D': 'chong dee',
            'çŸ­D': 'dune dee',
            'æƒ³è½‰èº«': 'song june sun',
            'æƒ³æ›è¡«': 'song woon sam',
            'æƒ³é£²æ°´': 'song yum yeah',
            'æƒ³é£Ÿå˜¢': 'song sick yeah',
            'æƒ³æŠ¹èº«': 'song mut sun',
            'æƒ³æ›ç‰‡': 'song woon pin',
            'æƒ³æŒ‰æ‘©': 'song on mall',
            'æƒ³é–‹é›»è¦–': 'song hoi din see',
            'æƒ³ç‡æ™‚é–“': 'song tie see garn',
            'æƒ³å‡ºè¡—': 'song chud guy',
            'æƒ³ç“è¦º': 'song fun gow'
        };

        // Check if Web Speech API is available
        if (!('speechSynthesis' in window)) {
            alert('Sorry, your browser does not support Text-to-Speech. Please use a modern browser like Chrome, Edge, or Safari.');
        }

        // Function to get animation duration in milliseconds based on animation class
        function getAnimationDuration(animationClass) {
            const durations = {
                'emoji-face': 3000,
                'emoji-face-updown': 2000,
                'emoji-face-leftright': 2000,
                'emoji-hand': 2500,
                'emoji-object': 4000,
                'emoji-arrow-up': 2000,
                'emoji-arrow-down': 2000,
                'emoji-arrow-left': 2000,
                'emoji-arrow-right': 2000,
                'emoji-food': 3500,
                'emoji-music': 4000,
                'emoji-nature': 5000
            };
            return durations[animationClass] || 3000;
        }

        // Function to determine emoji type and return appropriate animation class
        function getEmojiAnimationClass(emoji) {
            // Specific face animations - check these first
            if (emoji.includes('ğŸ™‚â€â†•ï¸')) {
                return 'emoji-face-updown';
            }
            if (emoji.includes('ğŸ™‚â€â†”ï¸')) {
                return 'emoji-face-leftright';
            }
            
            // Other faces - gentle bounce
            if (emoji.includes('ğŸ™‚') || emoji.includes('ğŸ¥¶') || emoji.includes('ğŸ¥µ') || emoji.includes('ğŸ˜Ÿ')) {
                return 'emoji-face';
            }
            
            // Hand gestures - subtle wave
            if (emoji.includes('ğŸ‘') || emoji.includes('ğŸ¤·') || emoji.includes('ğŸ¤”') || emoji.includes('ğŸ‘Œ')) {
                return 'emoji-hand';
            }
            
            // Arrows - directional movement
            if (emoji.includes('â¬†ï¸')) {
                return 'emoji-arrow-up';
            }
            if (emoji.includes('â¬‡ï¸')) {
                return 'emoji-arrow-down';
            }
            if (emoji.includes('â¬…ï¸')) {
                return 'emoji-arrow-left';
            }
            if (emoji.includes('â¡ï¸')) {
                return 'emoji-arrow-right';
            }
            
            // Food and drinks - subtle bounce
            if (emoji.includes('ğŸ›') || emoji.includes('ğŸ¥¤')) {
                return 'emoji-food';
            }
            
            // Music - gentle rotate
            if (emoji.includes('ğŸµ')) {
                return 'emoji-music';
            }
            
            // Nature - gentle sway
            if (emoji.includes('ğŸŒ³') || emoji.includes('ğŸ¾')) {
                return 'emoji-nature';
            }
            
            // Buildings - gentle float
            if (emoji.includes('ğŸ ') || emoji.includes('ğŸ¡')) {
                return 'emoji-object';
            }
            
            // Default: objects (gentle float)
            return 'emoji-object';
        }

        // Stop all currently playing speech
        function stopAllPlaying() {
            if (currentUtterance) {
                window.speechSynthesis.cancel();
                currentUtterance = null;
            }
            if (currentlyPlayingElement) {
                currentlyPlayingElement.classList.remove('playing');
                currentlyPlayingElement = null;
            }
        }

        // Play group function - plays text-to-speech, remembers what's been played
        function playGroup(group, itemElement) {
            const groupKey = itemElement.dataset.group;
            
            // Stop any currently playing speech
            stopAllPlaying();
            
            // Initialize played sounds tracking for this group if not exists
            if (!groupPlayedSounds.hasOwnProperty(groupKey)) {
                groupPlayedSounds[groupKey] = [];
            }
            
            // Find next unplayed sound
            let nextIndex = -1;
            for (let i = 0; i < group.files.length; i++) {
                if (!groupPlayedSounds[groupKey].includes(i)) {
                    nextIndex = i;
                    break;
                }
            }
            
            // If all sounds have been played, reset and start from beginning
            if (nextIndex === -1) {
                groupPlayedSounds[groupKey] = [];
                nextIndex = 0;
            }
            
            // Mark this sound as played
            groupPlayedSounds[groupKey].push(nextIndex);
            
            // Use English phonetic approximation for better Cantonese pronunciation
            const originalText = group.name || '';
            let textToSpeak = cantoneseToEnglishPhonetic[originalText] || originalText;
            
            if (!textToSpeak) {
                console.warn('No text to speak for group:', group);
                return;
            }
            
            // Create speech synthesis utterance
            const utterance = new SpeechSynthesisUtterance(textToSpeak);
            
            // Try to find an English voice (for English phonetic approximations)
            const voices = window.speechSynthesis.getVoices();
            let englishVoice = null;
            
            // Look for English voices - prioritize en-US
            // Common identifiers: 'en', 'English', 'United States', 'en-US'
            for (let voice of voices) {
                const voiceName = voice.name.toLowerCase();
                const voiceLang = voice.lang.toLowerCase();
                
                // Priority 1: en-US (US English)
                if (voiceLang.includes('en-us') || voiceLang === 'en-us') {
                    englishVoice = voice;
                    console.log('Found English voice (en-US):', voice.name, voice.lang);
                    break;
                }
            }
            
            // Priority 2: Any English variant
            if (!englishVoice) {
                for (let voice of voices) {
                    const voiceLang = voice.lang.toLowerCase();
                    const voiceName = voice.name.toLowerCase();
                    if (voiceLang.includes('en') || voiceName.includes('english')) {
                        englishVoice = voice;
                        console.log('Found English voice:', voice.name, voice.lang);
                        break;
                    }
                }
            }
            
            // Set voice and language
            if (englishVoice) {
                utterance.voice = englishVoice;
                utterance.lang = englishVoice.lang;
                console.log('Using English voice for Cantonese phonetic:', englishVoice.name, 'with lang:', englishVoice.lang);
                console.log('Speaking:', textToSpeak, '(original:', originalText + ')');
            } else {
                // Fallback: use English language code
                utterance.lang = 'en-US';
                console.warn('No English voice found, using en-US language code');
                console.log('Available voices:', voices.map(v => `${v.name} (${v.lang})`));
                console.log('Speaking:', textToSpeak, '(original:', originalText + ')');
            }
            
            // Configure speech settings
            utterance.rate = 1.4; // 40% faster (1.4x speed)
            utterance.pitch = 1.0; // Normal pitch
            utterance.volume = 1.0; // Full volume
            
            // When speech starts
            utterance.onstart = () => {
                itemElement.classList.add('playing');
                currentlyPlayingElement = itemElement;
                currentUtterance = utterance;
            };
            
            // When speech ends
            utterance.onend = () => {
                itemElement.classList.remove('playing');
                currentlyPlayingElement = null;
                currentUtterance = null;
            };
            
            // When speech errors
            utterance.onerror = (event) => {
                console.error('Speech synthesis error:', event);
                itemElement.classList.remove('playing');
                currentlyPlayingElement = null;
                currentUtterance = null;
            };
            
            // Speak the text
            window.speechSynthesis.speak(utterance);
        }

        // Create top bar with search and category tabs
        function createTopBar() {
            const topBar = document.createElement('div');
            topBar.className = 'top-bar';
            
            // Create search container
            const searchContainer = document.createElement('div');
            searchContainer.className = 'search-container';
            
            const searchBox = document.createElement('input');
            searchBox.type = 'text';
            searchBox.className = 'search-box';
            searchBox.placeholder = 'Search...';
            searchBox.setAttribute('aria-label', 'Search phrases');
            
            searchBox.addEventListener('input', (e) => {
                searchTerm = e.target.value;
                filterAndDisplayItems();
            });
            
            // Create category tabs
            const categories = [
                { name: 'å¸¸ç”¨', english: 'Common' },
                { name: 'ä¹œD', english: 'More/Less' },
                { name: 'æƒ³ä¹œä¹œ', english: 'Want' }
            ];
            const tabsContainer = document.createElement('div');
            tabsContainer.className = 'category-tabs';
            
            categories.forEach(category => {
                const tab = document.createElement('button');
                tab.className = `category-tab ${category.name === currentCategory ? 'active' : ''}`;
                tab.dataset.category = category.name;
                
                tab.innerHTML = `
                    <span>${category.name}</span>
                    <span class="category-english">${category.english}</span>
                `;
                
                tab.addEventListener('click', () => {
                    // Update active tab
                    document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Update current category
                    currentCategory = category.name;
                    
                    // Refresh displayed items
                    filterAndDisplayItems();
                });
                
                tabsContainer.appendChild(tab);
            });
            
            topBar.appendChild(tabsContainer);
            
            searchContainer.appendChild(searchBox);
            topBar.appendChild(searchContainer);
            document.body.insertBefore(topBar, document.getElementById('audioGrid'));
        }

        // Create floating info button
        function createInfoButton() {
            const infoButton = document.createElement('button');
            infoButton.className = 'info-button';
            infoButton.textContent = '?';
            infoButton.setAttribute('aria-label', 'About');
            infoButton.addEventListener('click', () => {
                document.getElementById('infoModal').classList.add('active');
            });
            document.body.appendChild(infoButton);
        }

        // Modal functionality
        function setupModal() {
            const modal = document.getElementById('infoModal');
            const closeButton = document.getElementById('modalClose');
            
            // Close button click
            closeButton.addEventListener('click', () => {
                modal.classList.remove('active');
            });
            
            // Click outside modal to close
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
            
            // ESC key to close
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && modal.classList.contains('active')) {
                    modal.classList.remove('active');
                }
            });
        }

        // Filter and display items based on current category and search term
        function filterAndDisplayItems() {
            const grid = document.getElementById('audioGrid');
            
            // Clear existing items
            grid.innerHTML = '';
            // Clear groupItems object
            Object.keys(groupItems).forEach(key => delete groupItems[key]);
            
            // Filter groups by current category and search term
            let filteredGroups = groups.filter(group => group.category === currentCategory);
            
            // If there's a search term, filter by it (search in name and english)
            if (searchTerm.trim() !== '') {
                const searchLower = searchTerm.toLowerCase().trim();
                filteredGroups = filteredGroups.filter(group => {
                    const nameMatch = (group.name || '').toLowerCase().includes(searchLower);
                    const englishMatch = (group.english || '').toLowerCase().includes(searchLower);
                    return nameMatch || englishMatch;
                });
            }
            
            // Create items for filtered groups
            filteredGroups.forEach((group, index) => {
                const originalIndex = groups.indexOf(group);
                const item = document.createElement('div');
                item.className = 'audio-item';
                item.dataset.group = originalIndex;
                
                // Use emoji and name from group object
                const emoji = group.emoji || 'ğŸµ';
                const name = group.name || '';
                const english = group.english || '';
                const phonetic = cantoneseToEnglishPhonetic[name] || '';
                
                // Get animation class based on emoji type
                const animationClass = getEmojiAnimationClass(emoji);
                
                item.innerHTML = `
                    <div class="emoji ${animationClass}" data-animation-class="${animationClass}">${emoji}</div>
                    <div class="filename">${name}</div>
                    <div class="english-translation">${english}</div>
                    <div class="phonetic-pronunciation">${phonetic}</div>
                `;
                
                // Get the emoji element
                const emojiElement = item.querySelector('.emoji');
                
                // Add click handler to trigger animation and play speech
                item.addEventListener('click', () => {
                    // Show phonetic pronunciation
                    item.classList.add('show-phonetic');
                    
                    // Trigger animation
                    emojiElement.classList.add('animate');
                    
                    // Remove animate class after animation completes
                    const animationDuration = getAnimationDuration(animationClass);
                    setTimeout(() => {
                        emojiElement.classList.remove('animate');
                    }, animationDuration);
                    
                    // Play text-to-speech
                    playGroup(group, item);
                });
                
                grid.appendChild(item);
                groupItems[originalIndex] = item;
            });
        }

        // Create audio items - all items are groups, displayed in natural array order
        function createAudioItems() {
            filterAndDisplayItems();
        }

        // Load voices when they become available
        function loadVoices() {
            const voices = window.speechSynthesis.getVoices();
            console.log('Available voices:', voices.map(v => `${v.name} (${v.lang})`));
            
            // Log English-related voices
            const englishVoices = voices.filter(v => {
                const lang = v.lang.toLowerCase();
                const name = v.name.toLowerCase();
                return lang.includes('en') || name.includes('english');
            });
            
            if (englishVoices.length > 0) {
                console.log('English voices found:', englishVoices.map(v => `${v.name} (${v.lang})`));
            } else {
                console.warn('No English voices found. Browser may use default voice.');
            }
            
            // Also log Chinese voices (as fallback option)
            const chineseVoices = voices.filter(v => {
                const lang = v.lang.toLowerCase();
                return lang.includes('zh');
            });
            if (chineseVoices.length > 0) {
                console.log('Chinese voices available (fallback):', chineseVoices.map(v => `${v.name} (${v.lang})`));
            }
        }
        
        // Some browsers load voices asynchronously - wait for them
        let voicesLoaded = false;
        
        function waitForVoices() {
            const voices = window.speechSynthesis.getVoices();
            if (voices.length > 0 && !voicesLoaded) {
                voicesLoaded = true;
                loadVoices();
            }
        }
        
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = () => {
                waitForVoices();
                loadVoices();
            };
        }
        
        // Initialize on page load
        window.addEventListener('DOMContentLoaded', () => {
            // Setup modal
            setupModal();
            
            // Create top bar with search and category tabs
            createTopBar();
            
            // Create floating info button
            createInfoButton();
            
            // Try loading voices immediately
            waitForVoices();
            loadVoices();
            
            // Also try after a short delay (some browsers need time)
            setTimeout(() => {
                waitForVoices();
                loadVoices();
            }, 500);
            
            createAudioItems();
        });
    </script>
</body>
</html>


