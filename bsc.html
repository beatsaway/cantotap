<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bridge Score Calculator / æ©‹ç‰Œè¨ˆåˆ†å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        .header h1 .zh {
            font-size: 24px;
            display: block;
            margin-top: 5px;
            opacity: 0.95;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .header p .zh {
            display: block;
            margin-top: 3px;
            font-size: 13px;
        }
        
        .keyterms-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .keyterms-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .keyterms-panel {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.3);
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 1000;
            padding: 30px;
        }
        
        .keyterms-panel.show {
            display: block;
        }
        
        .keyterms-panel h2 {
            color: #667eea;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        .keyterms-panel h2 .zh {
            display: block;
            margin-top: 5px;
            font-size: 20px;
            color: #764ba2;
        }
        
        .keyterms-panel .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #dc3545;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
        }
        
        .keyterms-panel .close-btn:hover {
            background: #c82333;
        }
        
        .term-item {
            margin-bottom: 15px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .term-item .term {
            font-weight: bold;
            color: #667eea;
            font-size: 16px;
        }
        
        .term-item .term-zh {
            font-weight: bold;
            color: #764ba2;
            font-size: 15px;
            display: block;
            margin-top: 3px;
        }
        
        .term-item .definition {
            margin-top: 8px;
            color: #555;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .term-item .definition-zh {
            display: block;
            margin-top: 5px;
            color: #666;
            font-size: 13px;
            line-height: 1.6;
        }
        
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
        
        .overlay.show {
            display: block;
        }
        
        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
        }
        
        .calculator-section {
            padding: 30px;
            border-right: 1px solid #eee;
        }
        
        .guide-section {
            padding: 30px;
            background: #f8f9fa;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
            font-size: 14px;
        }
        
        .form-group label .zh {
            display: block;
            font-size: 13px;
            color: #888;
            font-weight: 500;
            margin-top: 2px;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-group small {
            display: block;
            margin-top: 5px;
            color: #888;
            font-size: 12px;
        }
        
        .form-group small .zh {
            display: block;
            margin-top: 3px;
            font-size: 11px;
        }
        
        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .result {
            margin-top: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .result h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .result h3 .zh {
            display: block;
            font-size: 16px;
            color: #764ba2;
            margin-top: 3px;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
            font-size: 14px;
        }
        
        .result-item:last-child {
            border-bottom: none;
            margin-top: 10px;
            padding-top: 15px;
            font-weight: bold;
            font-size: 18px;
            color: #667eea;
        }
        
        .result-item .label {
            color: #666;
        }
        
        .result-item .label .zh {
            display: block;
            font-size: 12px;
            color: #999;
            margin-top: 2px;
        }
        
        .result-item .value {
            font-weight: 600;
            color: #333;
        }
        
        .guide-section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 22px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .guide-section h2 .zh {
            display: block;
            font-size: 20px;
            color: #764ba2;
            margin-top: 5px;
        }
        
        .guide-section h3 {
            color: #764ba2;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .guide-section h3 .zh {
            display: block;
            font-size: 15px;
            color: #856404;
            margin-top: 3px;
        }
        
        .guide-section p,
        .guide-section ul {
            margin-bottom: 15px;
            line-height: 1.6;
            font-size: 14px;
            color: #555;
        }
        
        .guide-section p .zh {
            display: block;
            margin-top: 5px;
            font-size: 13px;
            color: #666;
        }
        
        .guide-section ul {
            margin-left: 20px;
        }
        
        .guide-section li {
            margin-bottom: 8px;
        }
        
        .guide-section li .zh {
            display: block;
            margin-top: 3px;
            font-size: 13px;
            color: #666;
        }
        
        .guide-section code {
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 13px;
            color: #d63384;
        }
        
        .example {
            background: #fff3cd;
            padding: 12px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 3px solid #ffc107;
        }
        
        .example strong {
            color: #856404;
        }
        
        .example .zh {
            display: block;
            margin-top: 5px;
            font-size: 13px;
            color: #856404;
        }
        
        .bilingual {
            line-height: 1.8;
        }
        
        .bilingual .zh {
            display: block;
            margin-top: 3px;
            font-size: 0.9em;
            color: #666;
        }
        
        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
            }
            
            .calculator-section {
                border-right: none;
                border-bottom: 1px solid #eee;
            }
            
            .guide-section {
                max-height: none;
            }
        }
    </style>
</head>
<body>
    <div class="overlay" id="overlay" onclick="closeKeyTerms()"></div>
    <div class="keyterms-panel" id="keytermsPanel">
        <button class="close-btn" onclick="closeKeyTerms()">Ã—</button>
        <h2>Key Terms / é—œéµè©å½™<span class="zh">é‡è¦è¡“èªè§£é‡‹</span></h2>
        
        <div class="term-item">
            <div class="term">Contract / åˆç´„</div>
            <div class="term-zh">åˆç´„</div>
            <div class="definition">The bid that becomes the final contract for the hand.</div>
            <div class="definition-zh">æˆç‚ºè©²å±€æœ€çµ‚åˆç´„å˜…å«ç‰Œã€‚</div>
        </div>
        
        <div class="term-item">
            <div class="term">Tricks / å¢©</div>
            <div class="term-zh">å¢©</div>
            <div class="definition">A round of four cards, one from each player. You need 6 tricks as "book" plus the level bid.</div>
            <div class="definition-zh">å››å€‹ç©å®¶å„å‡ºä¸€å¼µç‰Œçµ„æˆå˜…ä¸€è¼ªã€‚åŸºæœ¬éœ€è¦6å¢©ï¼Œå†åŠ å«ç‰Œç´šæ•¸ã€‚</div>
        </div>
        
        <div class="term-item">
            <div class="term">Vulnerability / æœ‰å±€</div>
            <div class="term-zh">æœ‰å±€</div>
            <div class="definition">Affects bonuses and penalties. Rotates: Neither â†’ NS â†’ EW â†’ Both.</div>
            <div class="definition-zh">å½±éŸ¿çåˆ†åŒç½°åˆ†ã€‚è¼ªæµï¼šç„¡å±€ â†’ å—åŒ—æœ‰å±€ â†’ æ±è¥¿æœ‰å±€ â†’ é›™æ–¹æœ‰å±€ã€‚</div>
        </div>
        
        <div class="term-item">
            <div class="term">Doubled / åŠ å€</div>
            <div class="term-zh">åŠ å€</div>
            <div class="definition">Doubles contract points and changes overtrick/undertrick values.</div>
            <div class="definition-zh">å°‡åˆç´„åˆ†æ•¸åŠ å€ï¼Œä¸¦æ”¹è®Šè¶…å¢©åŒæ¬ å¢©å˜…åˆ†æ•¸ã€‚</div>
        </div>
        
        <div class="term-item">
            <div class="term">Redoubled / å†åŠ å€</div>
            <div class="term-zh">å†åŠ å€</div>
            <div class="definition">Quadruples contract points and further increases overtrick/undertrick values.</div>
            <div class="definition-zh">å°‡åˆç´„åˆ†æ•¸è®Šæˆå››å€ï¼Œä¸¦é€²ä¸€æ­¥å¢åŠ è¶…å¢©åŒæ¬ å¢©å˜…åˆ†æ•¸ã€‚</div>
        </div>
        
        <div class="term-item">
            <div class="term">Overtricks / è¶…å¢©</div>
            <div class="term-zh">è¶…å¢©</div>
            <div class="definition">Extra tricks won beyond the contract. Awarded bonus points.</div>
            <div class="definition-zh">è¶…éåˆç´„è¦æ±‚è´åˆ°å˜…é¡å¤–å¢©æ•¸ã€‚æœƒç²å¾—é¡å¤–åˆ†æ•¸ã€‚</div>
        </div>
        
        <div class="term-item">
            <div class="term">Undertricks / æ¬ å¢©</div>
            <div class="term-zh">æ¬ å¢©</div>
            <div class="definition">Tricks short of the contract. Results in penalties.</div>
            <div class="definition-zh">æœªé”åˆ°åˆç´„è¦æ±‚å˜…å¢©æ•¸ã€‚æœƒå°è‡´ç½°åˆ†ã€‚</div>
        </div>
        
        <div class="term-item">
            <div class="term">Game / æˆå±€</div>
            <div class="term-zh">æˆå±€</div>
            <div class="definition">Contract worth 100+ points. Awards game bonus (300/500).</div>
            <div class="definition-zh">åˆç´„åˆ†æ•¸é”åˆ°100åˆ†æˆ–ä»¥ä¸Šã€‚æœƒç²å¾—æˆå±€çåˆ†ï¼ˆ300/500åˆ†ï¼‰ã€‚</div>
        </div>
        
        <div class="term-item">
            <div class="term">Small Slam / å°æ»¿è²«</div>
            <div class="term-zh">å°æ»¿è²«</div>
            <div class="definition">6-level contract. Bonus: 500 (non-vul) or 750 (vul).</div>
            <div class="definition-zh">6ç´šåˆç´„ã€‚çåˆ†ï¼š500åˆ†ï¼ˆç„¡å±€ï¼‰æˆ–750åˆ†ï¼ˆæœ‰å±€ï¼‰ã€‚</div>
        </div>
        
        <div class="term-item">
            <div class="term">Grand Slam / å¤§æ»¿è²«</div>
            <div class="term-zh">å¤§æ»¿è²«</div>
            <div class="definition">7-level contract. Bonus: 1000 (non-vul) or 1500 (vul).</div>
            <div class="definition-zh">7ç´šåˆç´„ã€‚çåˆ†ï¼š1000åˆ†ï¼ˆç„¡å±€ï¼‰æˆ–1500åˆ†ï¼ˆæœ‰å±€ï¼‰ã€‚</div>
        </div>
        
        <div class="term-item">
            <div class="term">Book / åŸºæœ¬å¢©</div>
            <div class="term-zh">åŸºæœ¬å¢©</div>
            <div class="definition">The first 6 tricks don't count toward contract points. Only tricks 7-13 count.</div>
            <div class="definition-zh">é ­6å¢©å””è¨ˆå…¥åˆç´„åˆ†æ•¸ã€‚åªæœ‰ç¬¬7-13å¢©å…ˆè¨ˆåˆ†ã€‚</div>
        </div>
        
        <div class="term-item">
            <div class="term">Strain / èŠ±è‰²</div>
            <div class="term-zh">èŠ±è‰²</div>
            <div class="definition">The suit or no-trump of the contract (C, D, H, S, NT).</div>
            <div class="definition-zh">åˆç´„å˜…èŠ±è‰²æˆ–ç„¡å°‡ï¼ˆæ¢…èŠ±ã€æ–¹å¡Šã€ç´…å¿ƒã€é»‘æ¡ƒã€ç„¡å°‡ï¼‰ã€‚</div>
        </div>
        
        <div class="term-item">
            <div class="term">Level / ç´šæ•¸</div>
            <div class="term-zh">ç´šæ•¸</div>
            <div class="definition">The number in the contract (1-7). Level + 6 = tricks needed.</div>
            <div class="definition-zh">åˆç´„å…¥é¢å˜…æ•¸å­—ï¼ˆ1-7ï¼‰ã€‚ç´šæ•¸ + 6 = éœ€è¦å˜…å¢©æ•¸ã€‚</div>
        </div>
    </div>
    
    <div class="container">
        <div class="header">
            <button class="keyterms-btn" onclick="showKeyTerms()">Key Terms / é—œéµè©å½™</button>
            <h1>ğŸ´ Bridge Score Calculator<span class="zh">æ©‹ç‰Œè¨ˆåˆ†å™¨</span></h1>
            <p>Quick and easy scoring for contract bridge<span class="zh">å¿«é€Ÿç°¡å–®å˜…åˆç´„æ©‹ç‰Œè¨ˆåˆ†</span></p>
        </div>
        
        <div class="content">
            <div class="calculator-section">
                <form id="scoreForm">
                    <div class="form-group">
                        <label for="contract">Contract<span class="zh">åˆç´„</span></label>
                        <input type="text" id="contract" placeholder="e.g., 4S, 3NT, 2H" required>
                        <small>Format: Level + Suit (C/D/H/S/NT)<span class="zh">æ ¼å¼ï¼šç´šæ•¸ + èŠ±è‰²ï¼ˆC/D/H/S/NTï¼‰</span></small>
                    </div>
                    
                    <div class="form-group">
                        <label for="tricks">Tricks Made<span class="zh">è´åˆ°å˜…å¢©æ•¸</span></label>
                        <input type="number" id="tricks" min="0" max="13" placeholder="0-13" required>
                        <small>Total number of tricks won<span class="zh">ç¸½å…±è´åˆ°å¹¾å¤šå¢©</span></small>
                    </div>
                    
                    <div class="form-group">
                        <label for="vulnerability">Vulnerability<span class="zh">æœ‰å±€æƒ…æ³</span></label>
                        <select id="vulnerability" required>
                            <option value="none">Neither Vulnerable / é›™æ–¹ç„¡å±€</option>
                            <option value="we">We Are Vulnerable / æˆ‘æ–¹æœ‰å±€</option>
                            <option value="they">They Are Vulnerable / å°æ–¹æœ‰å±€</option>
                            <option value="both">Both Vulnerable / é›™æ–¹æœ‰å±€</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="doubled">Doubled/Redoubled<span class="zh">åŠ å€/å†åŠ å€</span></label>
                        <select id="doubled">
                            <option value="none">No / ç„¡</option>
                            <option value="x">Doubled / åŠ å€</option>
                            <option value="xx">Redoubled / å†åŠ å€</option>
                        </select>
                    </div>
                    
                    <button type="button" class="btn" onclick="calculateScore()">Calculate Score / è¨ˆç®—åˆ†æ•¸</button>
                </form>
                
                <div id="result" class="result" style="display: none;"></div>
            </div>
            
            <div class="guide-section">
                <h2>ğŸ“– Scoring Guide<span class="zh">è¨ˆåˆ†æŒ‡å—</span></h2>
                
                <h3>Contract Points<span class="zh">åˆç´„åˆ†æ•¸</span></h3>
                <p>Points for tricks bid and made (above book of 6):<span class="zh">å«åˆ°åŒåšåˆ°å˜…å¢©æ•¸åˆ†æ•¸ï¼ˆåŸºæœ¬6å¢©ä»¥ä¸Šï¼‰ï¼š</span></p>
                <ul>
                    <li><code>Clubs/Diamonds</code>: 20 points per trick<span class="zh"><code>æ¢…èŠ±/æ–¹å¡Š</code>ï¼šæ¯å¢©20åˆ†</span></li>
                    <li><code>Hearts/Spades</code>: 30 points per trick<span class="zh"><code>ç´…å¿ƒ/é»‘æ¡ƒ</code>ï¼šæ¯å¢©30åˆ†</span></li>
                    <li><code>No Trump</code>: 40 (1st trick) + 30 (each additional)<span class="zh"><code>ç„¡å°‡</code>ï¼š40åˆ†ï¼ˆç¬¬1å¢©ï¼‰+ 30åˆ†ï¼ˆä¹‹å¾Œæ¯å¢©ï¼‰</span></li>
                </ul>
                
                <h3>Game Bonus<span class="zh">æˆå±€çåˆ†</span></h3>
                <p>Awarded when contract points â‰¥ 100:<span class="zh">ç•¶åˆç´„åˆ†æ•¸ â‰¥ 100åˆ†æ™‚ç²å¾—ï¼š</span></p>
                <ul>
                    <li>Non-vulnerable: <strong>300 points</strong><span class="zh">ç„¡å±€ï¼š<strong>300åˆ†</strong></span></li>
                    <li>Vulnerable: <strong>500 points</strong><span class="zh">æœ‰å±€ï¼š<strong>500åˆ†</strong></span></li>
                </ul>
                
                <h3>Slam Bonuses<span class="zh">æ»¿è²«çåˆ†</span></h3>
                <ul>
                    <li><strong>Small Slam</strong> (6-level):<span class="zh"><strong>å°æ»¿è²«</strong>ï¼ˆ6ç´šï¼‰ï¼š</span>
                        <ul>
                            <li>Non-vul: 500 | Vul: 750<span class="zh">ç„¡å±€ï¼š500åˆ† | æœ‰å±€ï¼š750åˆ†</span></li>
                        </ul>
                    </li>
                    <li><strong>Grand Slam</strong> (7-level):<span class="zh"><strong>å¤§æ»¿è²«</strong>ï¼ˆ7ç´šï¼‰ï¼š</span>
                        <ul>
                            <li>Non-vul: 1000 | Vul: 1500<span class="zh">ç„¡å±€ï¼š1000åˆ† | æœ‰å±€ï¼š1500åˆ†</span></li>
                        </ul>
                    </li>
                </ul>
                
                <h3>Overtricks<span class="zh">è¶…å¢©</span></h3>
                <p>Extra tricks beyond contract:<span class="zh">è¶…éåˆç´„è¦æ±‚å˜…é¡å¤–å¢©æ•¸ï¼š</span></p>
                <ul>
                    <li><strong>Undoubled</strong>: Same as contract trick value<span class="zh"><strong>ç„¡åŠ å€</strong>ï¼šåŒåˆç´„å¢©æ•¸åˆ†æ•¸ä¸€æ¨£</span></li>
                    <li><strong>Doubled</strong>: 100 (non-vul) / 200 (vul) per trick<span class="zh"><strong>åŠ å€</strong>ï¼šæ¯å¢©100åˆ†ï¼ˆç„¡å±€ï¼‰/ 200åˆ†ï¼ˆæœ‰å±€ï¼‰</span></li>
                    <li><strong>Redoubled</strong>: 200 (non-vul) / 400 (vul) per trick<span class="zh"><strong>å†åŠ å€</strong>ï¼šæ¯å¢©200åˆ†ï¼ˆç„¡å±€ï¼‰/ 400åˆ†ï¼ˆæœ‰å±€ï¼‰</span></li>
                </ul>
                
                <h3>Undertricks (Penalties)<span class="zh">æ¬ å¢©ï¼ˆç½°åˆ†ï¼‰</span></h3>
                <p>For each trick short of contract:<span class="zh">æ¯æ¬ ä¸€å¢©ï¼š</span></p>
                <ul>
                    <li><strong>Undoubled</strong>: 50 (non-vul) / 100 (vul)<span class="zh"><strong>ç„¡åŠ å€</strong>ï¼š50åˆ†ï¼ˆç„¡å±€ï¼‰/ 100åˆ†ï¼ˆæœ‰å±€ï¼‰</span></li>
                    <li><strong>Doubled</strong>:<span class="zh"><strong>åŠ å€</strong>ï¼š</span>
                        <ul>
                            <li>Non-vul: 100, 200, 300, 300...<span class="zh">ç„¡å±€ï¼š100, 200, 300, 300...</span></li>
                            <li>Vul: 200, 300, 300, 300...<span class="zh">æœ‰å±€ï¼š200, 300, 300, 300...</span></li>
                        </ul>
                    </li>
                    <li><strong>Redoubled</strong>:<span class="zh"><strong>å†åŠ å€</strong>ï¼š</span>
                        <ul>
                            <li>Non-vul: 200, 400, 600, 600...<span class="zh">ç„¡å±€ï¼š200, 400, 600, 600...</span></li>
                            <li>Vul: 400, 600, 600, 600...<span class="zh">æœ‰å±€ï¼š400, 600, 600, 600...</span></li>
                        </ul>
                    </li>
                </ul>
                
                <div class="example">
                    <strong>Example:</strong> 4â™  contract, made 10 tricks, non-vulnerable<span class="zh"><strong>ä¾‹å­ï¼š</strong> 4â™ åˆç´„ï¼Œåšåˆ°10å¢©ï¼Œç„¡å±€</span><br>
                    Contract: 4 Ã— 30 = 120 points<span class="zh">åˆç´„ï¼š4 Ã— 30 = 120åˆ†</span><br>
                    Game bonus: 300 points<span class="zh">æˆå±€çåˆ†ï¼š300åˆ†</span><br>
                    <strong>Total: 420 points</strong><span class="zh"><strong>ç¸½åˆ†ï¼š420åˆ†</strong></span>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        function calculateScore() {
            const contractInput = document.getElementById('contract').value.toUpperCase().trim();
            const tricksMade = parseInt(document.getElementById('tricks').value);
            const vulnerability = document.getElementById('vulnerability').value;
            const doubled = document.getElementById('doubled').value;
            
            // Validate contract format
            const contractMatch = contractInput.match(/^([1-7])([CDHS]|NT)$/);
            if (!contractMatch) {
                alert('Invalid contract format. Use format like: 4S, 3NT, 2H\nç„¡æ•ˆåˆç´„æ ¼å¼ã€‚è«‹ç”¨æ ¼å¼ï¼š4S, 3NT, 2H');
                return;
            }
            
            const level = parseInt(contractMatch[1]);
            const strain = contractMatch[2];
            const tricksBid = level + 6;
            const overtricks = Math.max(0, tricksMade - tricksBid);
            const undertricks = Math.max(0, tricksBid - tricksMade);
            
            const isVulnerable = vulnerability === 'we' || vulnerability === 'both';
            const isDoubled = doubled === 'x';
            const isRedoubled = doubled === 'xx';
            
            // Calculate contract points
            let contractPoints = 0;
            if (strain === 'C' || strain === 'D') {
                contractPoints = level * 20;
            } else if (strain === 'H' || strain === 'S') {
                contractPoints = level * 30;
            } else if (strain === 'NT') {
                contractPoints = 40 + (level - 1) * 30;
            }
            
            // Apply doubling/redoubling to contract points
            if (isDoubled) {
                contractPoints *= 2;
            } else if (isRedoubled) {
                contractPoints *= 4;
            }
            
            // Game bonus (only if contract was made)
            let gameBonus = 0;
            if (undertricks === 0 && contractPoints >= 100) {
                gameBonus = isVulnerable ? 500 : 300;
            }
            
            // Slam bonuses (only if contract was made)
            let slamBonus = 0;
            if (undertricks === 0) {
                if (level === 6) {
                    slamBonus = isVulnerable ? 750 : 500;
                } else if (level === 7) {
                    slamBonus = isVulnerable ? 1500 : 1000;
                }
            }
            
            // Overtrick points
            let overtrickPoints = 0;
            if (overtricks > 0) {
                if (isDoubled) {
                    overtrickPoints = overtricks * (isVulnerable ? 200 : 100);
                } else if (isRedoubled) {
                    overtrickPoints = overtricks * (isVulnerable ? 400 : 200);
                } else {
                    // Undoubled overtricks use same trick value
                    if (strain === 'C' || strain === 'D') {
                        overtrickPoints = overtricks * 20;
                    } else if (strain === 'H' || strain === 'S') {
                        overtrickPoints = overtricks * 30;
                    } else {
                        overtrickPoints = overtricks * 30;
                    }
                }
            }
            
            // Undertrick penalties
            let undertrickPoints = 0;
            if (undertricks > 0) {
                if (isDoubled) {
                    if (isVulnerable) {
                        undertrickPoints = 200 + Math.max(0, (undertricks - 1)) * 300;
                    } else {
                        undertrickPoints = 100 + Math.max(0, (undertricks - 1)) * 200;
                    }
                } else if (isRedoubled) {
                    if (isVulnerable) {
                        undertrickPoints = 400 + Math.max(0, (undertricks - 1)) * 600;
                    } else {
                        undertrickPoints = 200 + Math.max(0, (undertricks - 1)) * 400;
                    }
                } else {
                    undertrickPoints = undertricks * (isVulnerable ? 100 : 50);
                }
            }
            
            // Total score (positive if made, negative if set)
            const totalScore = contractPoints + gameBonus + slamBonus + overtrickPoints - undertrickPoints;
            
            // Display result
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            
            const contractDisplay = level + (strain === 'NT' ? 'NT' : 
                strain === 'C' ? 'â™£' : 
                strain === 'D' ? 'â™¦' : 
                strain === 'H' ? 'â™¥' : 'â™ ');
            
            const doubledDisplay = isRedoubled ? 'XX' : isDoubled ? 'X' : '';
            
            resultDiv.innerHTML = `
                <h3>Score Breakdown<span class="zh">åˆ†æ•¸æ˜ç´°</span></h3>
                <div class="result-item">
                    <span class="label">Contract:<span class="zh">åˆç´„</span></span>
                    <span class="value">${contractDisplay}${doubledDisplay}</span>
                </div>
                <div class="result-item">
                    <span class="label">Tricks:<span class="zh">å¢©æ•¸</span></span>
                    <span class="value">${tricksMade} (Bid: ${tricksBid})<span class="zh">${tricksMade}ï¼ˆå«ï¼š${tricksBid}ï¼‰</span></span>
                </div>
                <div class="result-item">
                    <span class="label">Contract Points:<span class="zh">åˆç´„åˆ†æ•¸</span></span>
                    <span class="value">${contractPoints}</span>
                </div>
                ${gameBonus > 0 ? `
                <div class="result-item">
                    <span class="label">Game Bonus:<span class="zh">æˆå±€çåˆ†</span></span>
                    <span class="value">+${gameBonus}</span>
                </div>
                ` : ''}
                ${slamBonus > 0 ? `
                <div class="result-item">
                    <span class="label">Slam Bonus:<span class="zh">æ»¿è²«çåˆ†</span></span>
                    <span class="value">+${slamBonus}</span>
                </div>
                ` : ''}
                ${overtrickPoints > 0 ? `
                <div class="result-item">
                    <span class="label">Overtricks:<span class="zh">è¶…å¢©</span></span>
                    <span class="value">+${overtrickPoints} (${overtricks} trick${overtricks > 1 ? 's' : ''})<span class="zh">+${overtrickPoints}ï¼ˆ${overtricks}å¢©ï¼‰</span></span>
                </div>
                ` : ''}
                ${undertrickPoints > 0 ? `
                <div class="result-item">
                    <span class="label">Undertricks:<span class="zh">æ¬ å¢©</span></span>
                    <span class="value">-${undertrickPoints} (${undertricks} trick${undertricks > 1 ? 's' : ''})<span class="zh">-${undertrickPoints}ï¼ˆ${undertricks}å¢©ï¼‰</span></span>
                </div>
                ` : ''}
                <div class="result-item">
                    <span class="label">Total Score:<span class="zh">ç¸½åˆ†</span></span>
                    <span class="value">${totalScore >= 0 ? '+' : ''}${totalScore}</span>
                </div>
            `;
        }
        
        // Allow Enter key to calculate
        document.getElementById('scoreForm').addEventListener('submit', function(e) {
            e.preventDefault();
            calculateScore();
        });
        
        document.getElementById('contract').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                calculateScore();
            }
        });
        
        document.getElementById('tricks').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                calculateScore();
            }
        });
        
        function showKeyTerms() {
            document.getElementById('keytermsPanel').classList.add('show');
            document.getElementById('overlay').classList.add('show');
        }
        
        function closeKeyTerms() {
            document.getElementById('keytermsPanel').classList.remove('show');
            document.getElementById('overlay').classList.remove('show');
        }
        
        // Close on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeKeyTerms();
            }
        });
    </script>
</body>
</html>
